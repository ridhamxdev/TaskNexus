<div class="min-h-screen bg-gray-900 text-white">
  <!-- Sidebar -->
  <div class="fixed left-0 top-0 h-full w-64 bg-gray-800 border-r border-gray-700 z-10">
    <!-- Logo/Header -->
    <div class="p-6 border-b border-gray-700">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center">
          <i class="pi pi-shield text-white"></i>
        </div>
        <div>
          <h1 class="text-lg font-semibold">Admin Manager</h1>
          <p class="text-xs text-gray-400">Super Administrator</p>
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="mt-6">
      <div class="px-4 mb-4">
        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">MAIN MENU</p>
      </div>
      
      <ul class="space-y-1 px-4">
        <li>
          <button 
            (click)="setActiveTab('dashboard')"
            [class]="'w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ' + 
                     (activeTab === 'dashboard' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-gray-700')">
            <i class="pi pi-th-large mr-3"></i>
            Dashboard
          </button>
        </li>
        <li>
          <button 
            (click)="setActiveTab('users')"
            [class]="'w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ' + 
                     (activeTab === 'users' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-gray-700')">
            <i class="pi pi-users mr-3"></i>
            Users
          </button>
        </li>
        <li>
          <button 
            (click)="setActiveTab('transactions')"
            [class]="'w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ' + 
                     (activeTab === 'transactions' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-gray-700')">
            <i class="pi pi-credit-card mr-3"></i>
            Transactions
          </button>
        </li>
        <li>
          <button 
            (click)="setActiveTab('emails')"
            [class]="'w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ' + 
                     (activeTab === 'emails' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-gray-700')">
            <i class="pi pi-envelope mr-3"></i>
            Emails
          </button>
        </li>
      </ul>

      <!-- Settings Section -->
      <div class="px-4 mt-8 mb-4">
        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">SETTINGS</p>
      </div>
      
      <ul class="space-y-1 px-4">
        <li>
          <button 
            (click)="setActiveTab('settings')"
            [class]="'w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ' + 
                     (activeTab === 'settings' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-gray-700')">
            <i class="pi pi-cog mr-3"></i>
            Settings
          </button>
        </li>
        <li>
          <button 
            (click)="logout()"
            class="w-full flex items-center px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded-lg transition-colors">
            <i class="pi pi-sign-out mr-3"></i>
            Logout
          </button>
        </li>
      </ul>
    </nav>

    <!-- User Profile at Bottom -->
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center">
          <span class="text-sm font-semibold">{{ auth.getUser()?.name?.charAt(0) || 'A' }}</span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium truncate">{{ auth.getUser()?.name || 'Admin' }}</p>
          <p class="text-xs text-gray-400 truncate">{{ auth.getUser()?.email || 'admin@example.com' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="ml-64 min-h-screen">
    <!-- Top Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-xl font-semibold capitalize">{{ activeTab }}</h1>
          <p class="text-sm text-gray-400" *ngIf="activeTab === 'dashboard'">Here is today's report and performances</p>
        </div>
        
        <div class="flex items-center space-x-4">
          <!-- Search Bar -->
          <div class="relative" *ngIf="activeTab === 'users'">
            <input 
              type="text" 
              [(ngModel)]="userSearchTerm"
              placeholder="Search users..."
              class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
            <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          
          <!-- Current Time -->
          <div class="bg-gray-700 px-3 py-2 rounded-lg">
            <p class="text-xs text-gray-300">{{ currentTime }}</p>
          </div>
          
          <!-- Notifications -->
          <div class="relative">
            <button 
              (click)="toggleNotifications()"
              class="relative p-2 text-gray-400 hover:text-white transition-colors">
              <i class="pi pi-bell text-lg"></i>
              <span 
                *ngIf="unreadNotificationsCount > 0"
                class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs text-white font-bold">
                {{ unreadNotificationsCount > 9 ? '9+' : unreadNotificationsCount }}
              </span>
            </button>

            <!-- Notifications Dropdown -->
            <div 
              *ngIf="showNotifications"
              class="absolute right-0 top-12 w-96 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-50 max-h-96 overflow-hidden">
              
              <!-- Header -->
              <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                <h3 class="text-lg font-semibold">Notifications</h3>
                <button 
                  (click)="markAllAsRead()"
                  class="text-sm text-purple-400 hover:text-purple-300 transition-colors">
                  Mark all as read
                </button>
              </div>

              <!-- Notifications List -->
              <div class="max-h-80 overflow-y-auto">
                <div *ngIf="notifications.length === 0" class="p-4 text-center text-gray-400">
                  <i class="pi pi-bell-slash text-2xl mb-2"></i>
                  <p>No notifications yet</p>
                </div>

                <div 
                  *ngFor="let notification of notifications" 
                  [class]="'p-4 border-b border-gray-700 hover:bg-gray-700 transition-colors cursor-pointer ' + 
                           (notification.isRead ? '' : 'bg-gray-750')"
                  (click)="markAsRead(notification)">
                  
                  <div class="flex items-start space-x-3">
                    <!-- Icon based on type -->
                    <div [class]="'w-8 h-8 rounded-full flex items-center justify-center ' + getNotificationIconClass(notification.type)">
                      <i [class]="getNotificationIcon(notification.type) + ' text-white text-sm'"></i>
                    </div>

                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                      <p [class]="'text-sm ' + (notification.isRead ? 'text-gray-300' : 'text-white font-medium')">
                        {{ notification.title }}
                      </p>
                      <p class="text-xs text-gray-400 mt-1">{{ notification.message }}</p>
                      <p class="text-xs text-gray-500 mt-2">{{ formatNotificationTime(notification.createdAt) }}</p>
                    </div>

                    <!-- Unread indicator -->
                    <div 
                      *ngIf="!notification.isRead"
                      class="w-2 h-2 bg-purple-500 rounded-full mt-2">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Footer -->
              <div class="p-3 border-t border-gray-700 text-center">
                <button 
                  (click)="viewAllNotifications()"
                  class="text-sm text-purple-400 hover:text-purple-300 transition-colors">
                  View all notifications
                </button>
              </div>
            </div>

            <!-- Backdrop to close dropdown -->
            <div 
              *ngIf="showNotifications"
              (click)="closeNotifications()"
              class="fixed inset-0 z-40">
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <main class="p-6">
      <!-- Dashboard Tab -->
      <div *ngIf="activeTab === 'dashboard'" class="space-y-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-400">Total Users</p>
                <p class="text-2xl font-bold">{{ stats.totalUsers }}</p>
                <p class="text-xs text-green-400 mt-1">+{{ stats.monthlyGrowth }}% from last month</p>
              </div>
              <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                <i class="pi pi-users text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-400">Transactions</p>
                <p class="text-2xl font-bold">{{ stats.totalTransactions }}</p>
                <p class="text-xs text-green-400 mt-1">+18% from last month</p>
              </div>
              <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">
                <i class="pi pi-credit-card text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-400">New Users</p>
                <p class="text-2xl font-bold">{{ stats.newUsersThisMonth }}</p>
                <p class="text-xs text-green-400 mt-1">+12% from last month</p>
              </div>
              <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
                <i class="pi pi-user-plus text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-400">Satisfaction Rate</p>
                <p class="text-2xl font-bold">{{ stats.satisfactionRate }}%</p>
                <p class="text-xs text-green-400 mt-1">+4% from last month</p>
              </div>
              <div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center">
                <i class="pi pi-star text-white text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- User Performance Chart -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold">User Performance</h3>
              <select class="bg-gray-700 border border-gray-600 rounded px-3 py-1 text-sm">
                <option>Weekly</option>
                <option>Monthly</option>
                <option>Yearly</option>
              </select>
            </div>
            <div class="h-64 flex items-center justify-center text-gray-400">
              <p>Chart visualization would go here</p>
            </div>
          </div>

          <!-- User Activity -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold">User Activity</h3>
              <span class="text-sm text-gray-400">4 June 2024</span>
            </div>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                  <span class="text-sm">Present</span>
                </div>
                <span class="text-sm font-semibold">{{ stats.totalUsers - 25 }}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                  <span class="text-sm">On Leave</span>
                </div>
                <span class="text-sm font-semibold">15</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                  <span class="text-sm">On Holiday</span>
                </div>
                <span class="text-sm font-semibold">8</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                  <span class="text-sm">Absent</span>
                </div>
                <span class="text-sm font-semibold">2</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div *ngIf="activeTab === 'users'" class="space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">Users</h2>
          <div class="flex items-center space-x-4">
            <button class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
              <i class="pi pi-plus mr-2"></i>
              Add User
            </button>
          </div>
        </div>

        <!-- Users Table -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('id')">
                    <div class="flex items-center space-x-1">
                      <span>ID</span>
                      <i [class]="'pi ' + getUserSortIcon('id') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'id', 'text-gray-400': userSortField !== 'id'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('name')">
                    <div class="flex items-center space-x-1">
                      <span>User Name</span>
                      <i [class]="'pi ' + getUserSortIcon('name') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'name', 'text-gray-400': userSortField !== 'name'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('role')">
                    <div class="flex items-center space-x-1">
                      <span>Role</span>
                      <i [class]="'pi ' + getUserSortIcon('role') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'role', 'text-gray-400': userSortField !== 'role'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('phone')">
                    <div class="flex items-center space-x-1">
                      <span>Contact</span>
                      <i [class]="'pi ' + getUserSortIcon('phone') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'phone', 'text-gray-400': userSortField !== 'phone'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('balance')">
                    <div class="flex items-center space-x-1">
                      <span>Balance</span>
                      <i [class]="'pi ' + getUserSortIcon('balance') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'balance', 'text-gray-400': userSortField !== 'balance'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortUsers('status')">
                    <div class="flex items-center space-x-1">
                      <span>Status</span>
                      <i [class]="'pi ' + getUserSortIcon('status') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': userSortField === 'status', 'text-gray-400': userSortField !== 'status'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700">
                <tr *ngFor="let user of sortedUsers" class="hover:bg-gray-700 transition-colors">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">#{{ user.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center mr-3">
                        <span class="text-xs font-semibold">{{ user.name.charAt(0) }}</span>
                      </div>
                      <div>
                        <div class="text-sm font-medium text-white">{{ user.name }}</div>
                        <div class="text-sm text-gray-400">{{ user.email }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300 capitalize">{{ user.role }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ user.phone }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-400">{{ formatCurrency(user.balance) }}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span [class]="'inline-flex px-2 py-1 text-xs font-semibold rounded-full ' + 
                                   (user.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')">
                      {{ user.status }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div class="flex items-center space-x-2">
                      <button 
                        (click)="viewUserDetails(user)"
                        class="text-purple-400 hover:text-purple-300 transition-colors">
                        <i class="pi pi-eye"></i>
                      </button>
                      <button 
                        (click)="toggleUserStatus(user)"
                        class="text-yellow-400 hover:text-yellow-300 transition-colors">
                        <i class="pi pi-power-off"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Transactions Tab -->
      <div *ngIf="activeTab === 'transactions'" class="space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">Transactions</h2>
          <div class="flex items-center space-x-4">
            <button 
              (click)="clearTransactionFilters()"
              class="bg-gray-600 hover:bg-gray-500 px-3 py-2 rounded text-sm transition-colors">
              <i class="pi pi-filter-slash mr-1"></i>
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Enhanced Filter Controls -->
        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- General Search -->
            <div class="relative">
              <input 
                type="text" 
                [(ngModel)]="transactionSearchTerm"
                placeholder="Search transactions..."
                class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
              <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>

            <!-- Transaction Type Filter -->
            <select [(ngModel)]="transactionFilter" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all">All Types</option>
              <option value="CREDIT">Credit Only</option>
              <option value="DEBIT">Debit Only</option>
            </select>

            <!-- Enhanced User Filter -->
            <div class="relative">
              <button 
                (click)="toggleTransactionUserDropdown()"
                class="user-dropdown-button w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 pl-10 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 text-left flex items-center justify-between hover:bg-gray-600"
                [class.selected-user-display]="selectedTransactionUser">
                <div class="flex items-center min-w-0 flex-1">
                  <i class="pi pi-user text-gray-400 mr-3"></i>
                  <div class="min-w-0 flex-1">
                    <div *ngIf="selectedTransactionUser; else noUserSelected" class="truncate">
                      <span class="text-white font-medium">{{ selectedTransactionUser.name }}</span>
                      <span class="text-gray-400 text-xs ml-1">({{ selectedTransactionUser.email }})</span>
                    </div>
                    <ng-template #noUserSelected>
                      <span class="text-gray-400">Filter by user...</span>
                    </ng-template>
                  </div>
                </div>
                <i class="pi pi-chevron-down text-gray-400 ml-2 transition-transform" 
                   [class.rotate-180]="showTransactionUserDropdown"></i>
              </button>

              <!-- Enhanced User Dropdown -->
              <div *ngIf="showTransactionUserDropdown" 
                   class="user-dropdown absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-50 max-h-64 overflow-hidden">
                
                <!-- Clear Selection Option -->
                <div class="p-2 border-b border-gray-700">
                  <button 
                    (click)="removeTransactionUserFilter()"
                    class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded flex items-center">
                    <i class="pi pi-times text-red-400 mr-2"></i>
                    Clear user filter
                  </button>
                </div>

                <!-- Users List -->
                <div class="max-h-48 overflow-y-auto">
                  <div *ngIf="transactionUsers.length === 0" class="p-4 text-center text-gray-400">
                    <i class="pi pi-users text-2xl mb-2"></i>
                    <p class="text-sm">No users found in transactions</p>
                  </div>
                  
                  <button 
                    *ngFor="let user of transactionUsers; trackBy: trackByEmail"
                    (click)="selectTransactionUser(user)"
                    class="user-item w-full text-left px-4 py-3 hover:bg-gray-700 border-b border-gray-700 last:border-b-0">
                    <div class="flex items-center space-x-3">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-semibold">
                          {{ user.name.charAt(0).toUpperCase() }}
                        </span>
                      </div>
                      <div class="min-w-0 flex-1">
                        <div class="font-medium text-white truncate">{{ user.name }}</div>
                        <div class="text-xs text-gray-400 truncate">{{ user.email }}</div>
                      </div>
                      <div class="user-count text-xs text-gray-500">
                        {{ getTransactionCountForUser(user.email) }}
                      </div>
                    </div>
                  </button>
                </div>
              </div>

              <!-- Backdrop -->
              <div *ngIf="showTransactionUserDropdown" 
                   (click)="closeAllDropdowns()"
                   class="fixed inset-0 z-40"></div>
            </div>
          </div>

          <!-- Active Filters Display -->
          <div *ngIf="transactionFilter !== 'all' || selectedTransactionUser || transactionSearchTerm" 
               class="mt-3 flex flex-wrap gap-2">
            <span class="text-xs text-gray-400">Active filters:</span>
            
            <span *ngIf="transactionFilter !== 'all'" 
                  class="inline-flex items-center px-2 py-1 bg-purple-600 text-white text-xs rounded-full">
              Type: {{ transactionFilter }}
              <button (click)="transactionFilter = 'all'" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
            
            <span *ngIf="selectedTransactionUser" 
                  class="inline-flex items-center px-2 py-1 bg-blue-600 text-white text-xs rounded-full">
              User: {{ selectedTransactionUser.name }}
              <button (click)="removeTransactionUserFilter()" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
            
            <span *ngIf="transactionSearchTerm" 
                  class="inline-flex items-center px-2 py-1 bg-green-600 text-white text-xs rounded-full">
              Search: {{ transactionSearchTerm }}
              <button (click)="transactionSearchTerm = ''" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
          </div>
        </div>

        <!-- Transactions Table -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
          <!-- Results Counter and Page Size -->
          <div class="px-6 py-3 bg-gray-750 border-b border-gray-700 flex items-center justify-between">
            <p class="text-sm text-gray-400">
              Showing {{ transactionPaginationInfo.start }}-{{ transactionPaginationInfo.end }} of {{ transactionPaginationInfo.total }} transactions
            </p>
            <div class="flex items-center space-x-3">
              <label class="text-xs text-gray-400">Show:</label>
              <select 
                [(ngModel)]="transactionItemsPerPage" 
                (ngModelChange)="changeTransactionPageSize($event)"
                class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500">
                <option *ngFor="let size of transactionPageSizes" [value]="size">{{ size }}</option>
              </select>
              <span class="text-xs text-gray-400">per page</span>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('id')">
                    <div class="flex items-center space-x-1">
                      <span>ID</span>
                      <i [class]="'pi ' + getTransactionSortIcon('id') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'id', 'text-gray-400': transactionSortField !== 'id'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('user')">
                    <div class="flex items-center space-x-1">
                      <span>User</span>
                      <i [class]="'pi ' + getTransactionSortIcon('user') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'user', 'text-gray-400': transactionSortField !== 'user'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('type')">
                    <div class="flex items-center space-x-1">
                      <span>Type</span>
                      <i [class]="'pi ' + getTransactionSortIcon('type') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'type', 'text-gray-400': transactionSortField !== 'type'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('amount')">
                    <div class="flex items-center space-x-1">
                      <span>Amount</span>
                      <i [class]="'pi ' + getTransactionSortIcon('amount') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'amount', 'text-gray-400': transactionSortField !== 'amount'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('description')">
                    <div class="flex items-center space-x-1">
                      <span>Description</span>
                      <i [class]="'pi ' + getTransactionSortIcon('description') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'description', 'text-gray-400': transactionSortField !== 'description'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortTransactions('date')">
                    <div class="flex items-center space-x-1">
                      <span>Date</span>
                      <i [class]="'pi ' + getTransactionSortIcon('date') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': transactionSortField === 'date', 'text-gray-400': transactionSortField !== 'date'}"></i>
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700">
                <!-- Empty State -->
                <tr *ngIf="filteredTransactions.length === 0" class="hover:bg-gray-700">
                  <td colspan="6" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center">
                      <i class="pi pi-inbox text-4xl text-gray-500 mb-4"></i>
                      <h3 class="text-lg font-medium text-gray-300 mb-2">No transactions found</h3>
                      <p class="text-sm text-gray-400 mb-4">
                        {{ transactions.length === 0 ? 'No transactions have been created yet.' : 'Try adjusting your search filters.' }}
                      </p>
                      <button 
                        *ngIf="transactions.length > 0"
                        (click)="clearTransactionFilters()"
                        class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm transition-colors">
                        Clear Filters
                      </button>
                    </div>
                  </td>
                </tr>
                
                <tr *ngFor="let transaction of paginatedTransactions" class="hover:bg-gray-700 transition-colors">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">#{{ transaction.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-white">{{ transaction.user.name }}</div>
                    <div class="text-sm text-gray-400">{{ transaction.user.email }}</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span [class]="'inline-flex px-2 py-1 text-xs font-semibold rounded-full ' + 
                                   (transaction.type === 'CREDIT' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')">
                      {{ transaction.type }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium" [class]="getTransactionColor(transaction.type)">
                    {{ formatCurrency(transaction.amount) }}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">{{ transaction.description }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ formatDate(transaction.transactionDate) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination Controls -->
          <div *ngIf="transactionTotalPages > 1" class="px-6 py-4 bg-gray-750 border-t border-gray-700">
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-400">
                Page {{ transactionCurrentPage }} of {{ transactionTotalPages }}
              </div>
              
              <div class="flex items-center space-x-2">
                <!-- Previous Button -->
                <button 
                  (click)="previousTransactionPage()"
                  [disabled]="transactionCurrentPage === 1"
                  class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                  <i class="pi pi-chevron-left"></i>
                </button>
                
                <!-- Page Numbers -->
                <div class="flex items-center space-x-1">
                  <!-- First page if not in range -->
                  <button 
                    *ngIf="transactionShowFirstPage"
                    (click)="goToTransactionPage(1)"
                    class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 transition-colors">
                    1
                  </button>
                  
                  <!-- Ellipsis if gap exists -->
                  <span *ngIf="transactionShowFirstEllipsis" class="px-2 text-gray-400">...</span>
                  
                  <!-- Page numbers in range -->
                  <button 
                    *ngFor="let page of transactionPageNumbers"
                    (click)="goToTransactionPage(page)"
                    [class]="'px-3 py-1 rounded text-sm transition-colors ' + 
                             (page === transactionCurrentPage ? 'bg-purple-600 text-white' : 'bg-gray-600 text-white hover:bg-gray-500')">
                    {{ page }}
                  </button>
                  
                  <!-- Ellipsis if gap exists -->
                  <span *ngIf="transactionShowLastEllipsis" class="px-2 text-gray-400">...</span>
                  
                  <!-- Last page if not in range -->
                  <button 
                    *ngIf="transactionShowLastPage"
                    (click)="goToTransactionPage(transactionTotalPages)"
                    class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 transition-colors">
                    {{ transactionTotalPages }}
                  </button>
                </div>
                
                <!-- Next Button -->
                <button 
                  (click)="nextTransactionPage()"
                  [disabled]="transactionCurrentPage === transactionTotalPages"
                  class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                  <i class="pi pi-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Emails Tab -->
      <div *ngIf="activeTab === 'emails'" class="space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">Email Management</h2>
          <div class="flex items-center space-x-4">
            <button 
              (click)="clearEmailFilters()"
              class="bg-gray-600 hover:bg-gray-500 px-3 py-2 rounded text-sm transition-colors">
              <i class="pi pi-filter-slash mr-1"></i>
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Enhanced Filter Controls -->
        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- General Search -->
            <div class="relative">
              <input 
                type="text" 
                [(ngModel)]="emailSearchTerm"
                placeholder="Search emails..."
                class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
              <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>

            <!-- Email Status Filter -->
            <select [(ngModel)]="emailFilter" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all">All Status</option>
              <option value="SENT">Sent</option>
              <option value="FAILED">Failed</option>
              <option value="PENDING">Pending</option>
            </select>

            <!-- Enhanced User Filter -->
            <div class="relative">
              <button 
                (click)="toggleEmailUserDropdown()"
                class="user-dropdown-button w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 pl-10 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 text-left flex items-center justify-between hover:bg-gray-600"
                [class.selected-user-display]="selectedEmailUser">
                <div class="flex items-center min-w-0 flex-1">
                  <i class="pi pi-user text-gray-400 mr-3"></i>
                  <div class="min-w-0 flex-1">
                    <div *ngIf="selectedEmailUser; else noUserSelected" class="truncate">
                      <span class="text-white font-medium">{{ selectedEmailUser.name || 'Unknown' }}</span>
                      <span class="text-gray-400 text-xs ml-1">({{ selectedEmailUser.email }})</span>
                    </div>
                    <ng-template #noUserSelected>
                      <span class="text-gray-400">Filter by user...</span>
                    </ng-template>
                  </div>
                </div>
                <i class="pi pi-chevron-down text-gray-400 ml-2 transition-transform" 
                   [class.rotate-180]="showEmailUserDropdown"></i>
              </button>

              <!-- Enhanced User Dropdown -->
              <div *ngIf="showEmailUserDropdown" 
                   class="user-dropdown absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-50 max-h-64 overflow-hidden">
                
                <!-- Clear Selection Option -->
                <div class="p-2 border-b border-gray-700">
                  <button 
                    (click)="removeEmailUserFilter()"
                    class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded flex items-center">
                    <i class="pi pi-times text-red-400 mr-2"></i>
                    Clear user filter
                  </button>
                </div>

                <!-- Users List -->
                <div class="max-h-48 overflow-y-auto">
                  <div *ngIf="emailUsers.length === 0" class="p-4 text-center text-gray-400">
                    <i class="pi pi-users text-2xl mb-2"></i>
                    <p class="text-sm">No users found in emails</p>
                  </div>
                  
                  <button 
                    *ngFor="let user of emailUsers; trackBy: trackByEmail"
                    (click)="selectEmailUser(user)"
                    class="user-item w-full text-left px-4 py-3 hover:bg-gray-700 border-b border-gray-700 last:border-b-0">
                    <div class="flex items-center space-x-3">
                      <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-semibold">
                          {{ (user.name || user.email).charAt(0).toUpperCase() }}
                        </span>
                      </div>
                      <div class="min-w-0 flex-1">
                        <div class="font-medium text-white truncate">
                          {{ user.name || 'Unknown User' }}
                        </div>
                        <div class="text-xs text-gray-400 truncate">{{ user.email }}</div>
                      </div>
                                              <div class="user-count text-xs text-gray-500">
                          {{ getEmailCountForUser(user.email) }}
                        </div>
                    </div>
                  </button>
                </div>
              </div>

              <!-- Backdrop -->
              <div *ngIf="showEmailUserDropdown" 
                   (click)="closeAllDropdowns()"
                   class="fixed inset-0 z-40"></div>
            </div>
          </div>

          <!-- Active Filters Display -->
          <div *ngIf="emailFilter !== 'all' || selectedEmailUser || emailSearchTerm" 
               class="mt-3 flex flex-wrap gap-2">
            <span class="text-xs text-gray-400">Active filters:</span>
            
            <span *ngIf="emailFilter !== 'all'" 
                  class="inline-flex items-center px-2 py-1 bg-purple-600 text-white text-xs rounded-full">
              Status: {{ emailFilter }}
              <button (click)="emailFilter = 'all'" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
            
            <span *ngIf="selectedEmailUser" 
                  class="inline-flex items-center px-2 py-1 bg-blue-600 text-white text-xs rounded-full">
              User: {{ selectedEmailUser.name || selectedEmailUser.email }}
              <button (click)="removeEmailUserFilter()" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
            
            <span *ngIf="emailSearchTerm" 
                  class="inline-flex items-center px-2 py-1 bg-green-600 text-white text-xs rounded-full">
              Search: {{ emailSearchTerm }}
              <button (click)="emailSearchTerm = ''" class="ml-1 hover:text-gray-300">
                <i class="pi pi-times"></i>
              </button>
            </span>
          </div>
        </div>

        <!-- Emails Table -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
          <!-- Results Counter and Page Size -->
          <div class="px-6 py-3 bg-gray-750 border-b border-gray-700 flex items-center justify-between">
            <p class="text-sm text-gray-400">
              Showing {{ emailPaginationInfo.start }}-{{ emailPaginationInfo.end }} of {{ emailPaginationInfo.total }} emails
            </p>
            <div class="flex items-center space-x-3">
              <label class="text-xs text-gray-400">Show:</label>
              <select 
                [(ngModel)]="emailItemsPerPage" 
                (ngModelChange)="changeEmailPageSize($event)"
                class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500">
                <option *ngFor="let size of emailPageSizes" [value]="size">{{ size }}</option>
              </select>
              <span class="text-xs text-gray-400">per page</span>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('id')">
                    <div class="flex items-center space-x-1">
                      <span>ID</span>
                      <i [class]="'pi ' + getEmailSortIcon('id') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'id', 'text-gray-400': emailSortField !== 'id'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('to')">
                    <div class="flex items-center space-x-1">
                      <span>To</span>
                      <i [class]="'pi ' + getEmailSortIcon('to') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'to', 'text-gray-400': emailSortField !== 'to'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('from')">
                    <div class="flex items-center space-x-1">
                      <span>From</span>
                      <i [class]="'pi ' + getEmailSortIcon('from') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'from', 'text-gray-400': emailSortField !== 'from'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('subject')">
                    <div class="flex items-center space-x-1">
                      <span>Subject</span>
                      <i [class]="'pi ' + getEmailSortIcon('subject') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'subject', 'text-gray-400': emailSortField !== 'subject'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('status')">
                    <div class="flex items-center space-x-1">
                      <span>Status</span>
                      <i [class]="'pi ' + getEmailSortIcon('status') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'status', 'text-gray-400': emailSortField !== 'status'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition-colors"
                      (click)="sortEmails('date')">
                    <div class="flex items-center space-x-1">
                      <span>Sent At</span>
                      <i [class]="'pi ' + getEmailSortIcon('date') + ' text-xs'" 
                         [ngClass]="{'text-purple-400': emailSortField === 'date', 'text-gray-400': emailSortField !== 'date'}"></i>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700">
                <!-- Empty State -->
                <tr *ngIf="filteredEmails.length === 0" class="hover:bg-gray-700">
                  <td colspan="7" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center">
                      <i class="pi pi-envelope text-4xl text-gray-500 mb-4"></i>
                      <h3 class="text-lg font-medium text-gray-300 mb-2">No emails found</h3>
                      <p class="text-sm text-gray-400 mb-4">
                        {{ emails.length === 0 ? 'No emails have been sent yet.' : 'Try adjusting your search filters.' }}
                      </p>
                      <button 
                        *ngIf="emails.length > 0"
                        (click)="clearEmailFilters()"
                        class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm transition-colors">
                        Clear Filters
                      </button>
                    </div>
                  </td>
                </tr>
                
                <tr *ngFor="let email of paginatedEmails" class="hover:bg-gray-700 transition-colors">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">#{{ email.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-white">{{ email.to }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                    <div *ngIf="email.sender; else noSender">
                      <div class="font-medium">{{ email.sender.name }}</div>
                      <div class="text-xs text-gray-400">{{ email.sender.email }}</div>
                    </div>
                    <ng-template #noSender>
                      <span class="text-gray-500 italic">System</span>
                    </ng-template>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">{{ email.subject }}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span [class]="'inline-flex px-2 py-1 text-xs font-semibold rounded-full ' + getStatusColor(email.status)">
                      {{ email.status }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ formatDate(email.sentAt) }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button 
                      *ngIf="email.status === 'FAILED'"
                      (click)="resendEmail(email)"
                      class="text-purple-400 hover:text-purple-300 transition-colors">
                      <i class="pi pi-refresh mr-1"></i>
                      Resend
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination Controls -->
          <div *ngIf="emailTotalPages > 1" class="px-6 py-4 bg-gray-750 border-t border-gray-700">
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-400">
                Page {{ emailCurrentPage }} of {{ emailTotalPages }}
              </div>
              
              <div class="flex items-center space-x-2">
                <!-- Previous Button -->
                <button 
                  (click)="previousEmailPage()"
                  [disabled]="emailCurrentPage === 1"
                  class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                  <i class="pi pi-chevron-left"></i>
                </button>
                
                <!-- Page Numbers -->
                <div class="flex items-center space-x-1">
                  <!-- First page if not in range -->
                  <button 
                    *ngIf="emailShowFirstPage"
                    (click)="goToEmailPage(1)"
                    class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 transition-colors">
                    1
                  </button>
                  
                  <!-- Ellipsis if gap exists -->
                  <span *ngIf="emailShowFirstEllipsis" class="px-2 text-gray-400">...</span>
                  
                  <!-- Page numbers in range -->
                  <button 
                    *ngFor="let page of emailPageNumbers"
                    (click)="goToEmailPage(page)"
                    [class]="'px-3 py-1 rounded text-sm transition-colors ' + 
                             (page === emailCurrentPage ? 'bg-purple-600 text-white' : 'bg-gray-600 text-white hover:bg-gray-500')">
                    {{ page }}
                  </button>
                  
                  <!-- Ellipsis if gap exists -->
                  <span *ngIf="emailShowLastEllipsis" class="px-2 text-gray-400">...</span>
                  
                  <!-- Last page if not in range -->
                  <button 
                    *ngIf="emailShowLastPage"
                    (click)="goToEmailPage(emailTotalPages)"
                    class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 transition-colors">
                    {{ emailTotalPages }}
                  </button>
                </div>
                
                <!-- Next Button -->
                <button 
                  (click)="nextEmailPage()"
                  [disabled]="emailCurrentPage === emailTotalPages"
                  class="px-3 py-1 rounded bg-gray-600 text-white text-sm hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                  <i class="pi pi-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab === 'settings'" class="space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">System Settings</h2>
          <button 
            (click)="saveSettings()"
            [disabled]="isSavingSettings"
            class="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed px-4 py-2 rounded-lg text-sm font-medium transition-colors">
            <i class="pi pi-save mr-2"></i>
            {{ isSavingSettings ? 'Saving...' : 'Save Settings' }}
          </button>
        </div>

        <!-- Settings Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Daily Deduction Setting -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                  <i class="pi pi-credit-card text-white"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold">Daily Deduction Amount</h3>
                  <p class="text-sm text-gray-400">Set the daily deduction amount for users</p>
                </div>
              </div>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Amount ($)</label>
                <input 
                  type="number" 
                  [(ngModel)]="settings.dailyDeductionAmount"
                  min="1"
                  max="1000"
                  step="1"
                  class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
              </div>
              
              <div class="bg-gray-700 rounded p-3">
                <p class="text-xs text-gray-300">
                  <i class="pi pi-info-circle mr-1"></i>
                  This amount will be deducted from all users daily at 1:00 AM. Current amount: {{ settings.dailyDeductionAmount }}
                </p>
              </div>
            </div>
          </div>

          <!-- Email Notifications Setting -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center">
                  <i class="pi pi-envelope text-white"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold">Email Notifications</h3>
                  <p class="text-sm text-gray-400">Configure email notification preferences</p>
                </div>
              </div>
            </div>
            
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <div>
                  <label class="text-sm font-medium text-gray-300">Transaction Notifications</label>
                  <p class="text-xs text-gray-400">Send emails for transaction activities</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="settings.emailNotifications.transactions"
                    class="sr-only peer">
                  <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                </label>
              </div>
              
              <div class="flex items-center justify-between">
                <div>
                  <label class="text-sm font-medium text-gray-300">Daily Deduction Alerts</label>
                  <p class="text-xs text-gray-400">Send summary emails after daily deductions</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="settings.emailNotifications.dailyDeductions"
                    class="sr-only peer">
                  <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                </label>
              </div>

              <div class="bg-gray-700 rounded p-3">
                <p class="text-xs text-gray-300">
                  <i class="pi pi-info-circle mr-1"></i>
                  Email notifications help keep you informed about system activities and user transactions.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- System Information -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h3 class="text-lg font-semibold mb-4">System Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-gray-700 rounded p-4">
              <p class="text-sm text-gray-400">Last Settings Update</p>
              <p class="text-white font-medium">{{ settings.lastUpdated ? formatDate(settings.lastUpdated) : 'Never' }}</p>
            </div>
            <div class="bg-gray-700 rounded p-4">
              <p class="text-sm text-gray-400">Settings Version</p>
              <p class="text-white font-medium">v1.0.0</p>
            </div>
            <div class="bg-gray-700 rounded p-4">
              <p class="text-sm text-gray-400">Configuration Status</p>
              <p class="text-green-400 font-medium">
                <i class="pi pi-check-circle mr-1"></i>
                Active
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Overlay -->
      <div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 flex items-center space-x-4">
          <i class="pi pi-spin pi-spinner text-purple-500 text-xl"></i>
          <span class="text-white">Loading...</span>
        </div>
      </div>
    </main>
  </div>
</div> 
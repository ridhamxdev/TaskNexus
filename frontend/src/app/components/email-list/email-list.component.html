<div class="min-h-screen bg-gray-50 p-4">
  <div class="container mx-auto max-w-7xl">
    <p-card class="shadow-xl">
      <ng-template pTemplate="header">
        <div class="flex items-center justify-between p-6">
          <div class="flex items-center gap-3">
            <i class="pi pi-envelope text-3xl text-blue-600"></i>
            <h1 class="text-3xl font-bold text-gray-800">Sent Emails</h1>
          </div>
          <p-button 
            label="Refresh" 
            icon="pi pi-refresh" 
            (onClick)="loadSentEmails()"
            severity="secondary">
          </p-button>
        </div>
      </ng-template>

      <ng-template pTemplate="content">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-12">
          <p-progressSpinner styleClass="w-16 h-16"></p-progressSpinner>
          <p class="text-gray-600 mt-4 text-lg">Loading your sent emails...</p>
        </div>

        <!-- Error State -->
        <p-message 
          *ngIf="error && !isLoading" 
          severity="error" 
          [text]="error"
          styleClass="w-full mb-4">
        </p-message>

        <!-- Emails Table -->
        <div *ngIf="!isLoading && !error && sentEmails.length > 0">
          <p-table 
            [value]="sentEmails" 
            [paginator]="true" 
            [rows]="10"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} emails"
            [rowsPerPageOptions]="[10, 25, 50]"
            styleClass="p-datatable-striped">
            
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">ID</th>
                <th>Recipient</th>
                <th>Subject</th>
                <th>Date & Time</th>
                <th class="text-center">Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-email>
              <tr>
                <td class="text-center">
                  <span class="font-mono text-sm bg-gray-100 px-2 py-1 rounded">#{{ email.id }}</span>
                </td>
                <td>
                  <div class="flex items-center gap-2">
                    <i class="pi pi-user text-gray-500"></i>
                    <span class="font-medium text-gray-800">{{ email.recipient }}</span>
                  </div>
                </td>
                <td>
                  <div class="max-w-xs">
                    <span class="font-medium text-gray-800 truncate block">{{ email.subject }}</span>
                  </div>
                </td>
                <td>
                  <div class="flex flex-col">
                    <span class="font-semibold text-gray-800">{{ email.sentAt | date:'mediumDate' }}</span>
                    <span class="text-sm text-gray-500">{{ email.sentAt | date:'shortTime' }}</span>
                  </div>
                </td>
                <td class="text-center">
                  <p-tag 
                    [value]="getStatusLabel(email.status)" 
                    [severity]="getStatusSeverity(email.status)"
                    [icon]="getStatusIcon(email.status)">
                  </p-tag>
                </td>
                <td class="text-center">
                  <p-button 
                    icon="pi pi-eye" 
                    severity="info" 
                    size="small"
                    (onClick)="viewEmailDetails(email)"
                    pTooltip="View Details"
                    tooltipPosition="top">
                  </p-button>
                </td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="text-center py-12">
                  <div class="flex flex-col items-center">
                    <i class="pi pi-envelope text-6xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 text-lg mb-4">No emails sent yet</p>
                    <p class="text-gray-500 mb-6">Your sent emails will appear here once you start sending emails.</p>
                    <p-button 
                      label="Send Email" 
                      icon="pi pi-send" 
                      routerLink="/send-email"
                      severity="secondary">
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && !error && sentEmails.length === 0" class="text-center py-12">
          <i class="pi pi-envelope text-6xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">No Emails Sent Yet</h3>
          <p class="text-gray-500 mb-6">You haven't sent any emails yet. Start by sending your first email!</p>
          <p-button 
            label="Send Email" 
            icon="pi pi-send" 
            routerLink="/send-email"
            severity="secondary">
          </p-button>
        </div>
      </ng-template>
    </p-card>
  </div>
</div>

<!-- Email Details Dialog -->
<p-dialog 
  header="Email Details" 
  [(visible)]="showEmailDialog" 
  [modal]="true" 
  [style]="{width: '50vw'}"
  [draggable]="false"
  [resizable]="false">
  
  <div *ngIf="selectedEmail" class="space-y-4">
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Email ID</label>
        <span class="font-mono text-sm bg-gray-100 px-2 py-1 rounded">#{{ selectedEmail.id }}</span>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <p-tag 
          [value]="getStatusLabel(selectedEmail.status)" 
          [severity]="getStatusSeverity(selectedEmail.status)"
          [icon]="getStatusIcon(selectedEmail.status)">
        </p-tag>
      </div>
    </div>
    
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Recipient</label>
      <p class="text-gray-900">{{ selectedEmail.recipient }}</p>
    </div>
    
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
      <p class="text-gray-900">{{ selectedEmail.subject }}</p>
    </div>
    
    <div *ngIf="selectedEmail.body">
      <label class="block text-sm font-medium text-gray-700 mb-1">Message</label>
      <div class="bg-gray-50 p-3 rounded-lg border">
        <p class="text-gray-900 whitespace-pre-wrap">{{ selectedEmail.body }}</p>
      </div>
    </div>
    
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Sent At</label>
        <p class="text-gray-900">{{ selectedEmail.sentAt | date:'medium' }}</p>
      </div>
      <div *ngIf="selectedEmail.attempts">
        <label class="block text-sm font-medium text-gray-700 mb-1">Attempts</label>
        <p class="text-gray-900">{{ selectedEmail.attempts }}</p>
      </div>
    </div>
    
    <div *ngIf="selectedEmail.failureReason">
      <label class="block text-sm font-medium text-gray-700 mb-1">Failure Reason</label>
      <div class="bg-red-50 p-3 rounded-lg border border-red-200">
        <p class="text-red-800">{{ selectedEmail.failureReason }}</p>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <p-button 
      label="Close" 
      icon="pi pi-times" 
      (onClick)="closeEmailDialog()"
      severity="secondary">
    </p-button>
  </ng-template>
</p-dialog>
